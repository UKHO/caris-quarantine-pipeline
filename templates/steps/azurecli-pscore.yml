parameters:
  - name: displayName
    type: string
  - name: azureSubscription
    type: string
  - name: inlineScript
    type: string
  - name: stepName
    type: string
    default: ''
  - name: importHelmPipelineModule
    type: boolean
    default: false

steps:
- ${{ if ne(parameters.stepName, '') }}:
  - task: AzureCLI@2
    name: ${{ parameters.stepName }}
    displayName: ${{ parameters.displayName }}
    inputs:
      azureSubscription: ${{ parameters.azureSubscription }}
      scriptType: 'pscore'
      scriptLocation: 'inlineScript'
      inlineScript: |
        ${{ if eq(parameters.importHelmPipelineModule, true) }}:
          Import-Module "$(Build.SourcesDirectory)/scripts/helm/HelmPipeline.psd1" -Force

        ${{ parameters.inlineScript }}
- ${{ if eq(parameters.stepName, '') }}:
  - task: AzureCLI@2
    displayName: ${{ parameters.displayName }}
    inputs:
      azureSubscription: ${{ parameters.azureSubscription }}
      scriptType: 'pscore'
      scriptLocation: 'inlineScript'
      inlineScript: |
        ${{ if eq(parameters.importHelmPipelineModule, true) }}:
          Import-Module "$(Build.SourcesDirectory)/scripts/helm/HelmPipeline.psd1" -Force

        ${{ parameters.inlineScript }}
